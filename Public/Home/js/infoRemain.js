define("member:app/script/page/infoRemain",function(e){function t(){if(a()){f&&m?1==f||3==f?h(_(f).get_message_url,_(f).tpl,b,m):2==f&&h(_(f).get_info_url,_(f).tpl,b,m):!f&&m?h(_(1).get_message_url,_(1).tpl,b,m):f&&!m?1==f||3==f?h(_(f).get_message_url,_(f).tpl,b):2==f&&h(_(f).get_info_url,_(f).tpl,b):f||m||h(_(f).get_message_url,_(f).tpl,b);for(var e=n(".type-tab-btn a"),t=Array.prototype.slice.call(e),s=0,i=t.length;i>s;s++)n(t[s]).attr("data-type")==f&&(n(".type-tab-btn a").removeClass("active"),n(t[s]).addClass("active"))}else h(_(f).get_message_url,_(f).tpl,b)}function a(){return!(!window.history||!history.pushState)}e("member:app/script/module/handlebars-helper");var n=e("common:lib/jquery/jquery-1.11.3"),s=e("common:widgets/site-basejs/msg"),i=e("member:app/script/module/config-url"),l=(e("member:app/script/handlebars"),e("member:app/script/module/load-data")),r=e("member:app/script/module/cookie"),c=e("member:app/script/module/checkAll"),p=e("member:app/script/module/isToken"),u=e("member:app/script/module/href-parameter"),o=e("member:app/script/module/dialog"),d=new o("alert"),f=u.get("type")||1,m=u.get("current")||1,g=JSON.parse(decodeURIComponent(r.getCookie("MEIZUSTORESESSIONVAL"))).uid,_=function(e){return _activity={get_message_url:i+"/vip/user/"+g+"/message/"+e,read_message_url:i+"/vip/user/"+g+"/message/read",delete_message_url:i+"/vip/user/"+g+"/message/delete",get_info_url:i+"/vip/user/"+g+"/notification",read_info_url:i+"/vip/user/"+g+"/notification/read",delete_info_url:i+"/vip/user/"+g+"/notification/delete",tpl:'<div class="info-list">\n    <ul id="check-items">\n        {{#each data.resultList}}\n        {{#equal status 0}}\n        <li class="unread clearfix">\n        {{/equal}}\n        {{#equal status 1}}\n        <li class="read clearfix">\n        {{/equal}}\n            {{!消息id}}\n            <input type="hidden" class="_infoId" value="{{id}}">\n            {{!消息发布的时间}}\n            {{#if publishTime}}\n            <input type="hidden" class="_timeFull" value="{{publishTime}}">\n            <span class="timeFull hide">{{transFormatDate publishTime}}</span>\n            <span class="half">{{transFormatDateHalf publishTime}}</span>\n            <span class="splitTime f-fl">{{transFormatDateFull publishTime}}</span>\n            {{else}}\n            <input type="hidden" class="_timeFull" value="{{createTime}}">\n            <span class="timeFull hide">{{transFormatDate createTime}}</span>\n            <span class="half">{{transFormatDateHalf createTime}}</span>\n            <span class="splitTime f-fl">{{transFormatDateFull createTime}}</span>\n            {{/if}}\n            <input type="checkbox" class="f-fl">\n            <span class="tips f-fl">[ {{readStatus status}} ]</span>\n            {{#if link}}\n            <a class="_unread f-fl" href="{{link}}" target="_blank">\n                <span class="infoText">{{content}}</span>\n                <span class="seeDetail">点击查看详情>></span>\n            </a>\n            {{else}}\n                {{#if templateCode}}\n                    <a class="_unread f-fl" href="{{infoUrl templateProperties}}" target="_blank">\n                        <span class="infoText">{{template templateProperties templateCode}}</span>\n                        <span class="seeDetail">点击查看详情>></span>\n                    </a>\n                {{else}}\n                <a class="_unread f-fl" href="javascript:;">\n                    <span class="infoText">{{content}}</span>\n                </a>\n                {{/if}}\n            {{/if}}\n            {{#if imgurl}}\n            <div class="pic">\n                <a  class="_unread" href="{{link}}" target="_blank">\n                   <img src="{{imgurl}}"> \n                </a>\n            </div>\n            {{/if}}\n        </li>\n        {{/each}}\n    </ul>\n</div>\n<div class="content-bottom clearfix">\n    <div class="part f-fl">\n        <label>\n            <input type="checkbox" id="all-check-btn" class="allCheck f-fl">\n            <span>全选本页</span>\n        </label>\n    </div>\n    <div class="part f-fl">\n        <a href="javascript:;" class="remarkYes">标为已读</a><a class="delete" href="javascript:;">删除</a>\n    </div>\n</div>\n'}},v=function(){p.get({url:i+"/vip/user/"+g+"/unreadNum",successCallback:function(e){var t=0==e.data.notification?"":e.data.notification,a=0==e.data.actMessage?"":e.data.actMessage,i=0==e.data.sysMessage?"":e.data.sysMessage,l=t+a+i;if(n("._actAmount").text(a),n("._tradeAmount").text(t),n("._sysAmount").text(i),s){if(l>0)return void s.setMsgStatus(!0);s.setMsgStatus(!1)}}})};v();var h=function(e,t,a,n){new l({url:e,container:"#tableList",tpl:t,noListStr:"您暂无此类消息提醒！",sendData:{pageSize:10,current:n},pageType:"default",tplFn:null,callback:a})},b=function(){var e=[],t=[],a="",s=n("#check-items").eq(0),i=s.find("li"),l=i.find("._timeFull"),r=n(".type-tab-btn .active").attr("data-type");e=Array.prototype.slice.call(l);for(var u=0;u<e.length;u++){var o="";o+=new Date(Number(e[u].value)).getFullYear().toString(),o+=new Date(Number(e[u].value)).getMonth().toString(),t.push(o),t[u-1]&&t[u]==t[u-1]?n(n(".timeFull")[u]).addClass("hide"):n(n(".timeFull")[u]).removeClass("hide")}var f=(new c({contain:n("#check-items"),btn:n("#all-check-btn")}),function(e,t){$_item=s.find(".active");for(var i=0;i<$_item.length;i++){var l=n($_item[i]).find("._infoId").val();a+=l+","}return $_item.length<=0?void d.run("请选择需要操作的消息！"):void p.post({url:e,datas:a,successCallback:t})}),m=function(){var e=n("#check-items li").length,t=n(".meiui_pagination .isPage").length,a=Number(n(".meiui_pagination .active a").text()),s=t-1>0?t-1:1;if(0>=e)if("1"==r||"3"==r){if(a==t)return void h(_(r).get_message_url,_(r).tpl,b,s);h(_(r).get_message_url,_(r).tpl,b,a)}else if("2"==r){if(a==t)return void h(_(r).get_info_url,_(r).tpl,b,s);h(_(r).get_info_url,_(r).tpl,b,a)}},y=function(e){r=n(".type-tab-btn").find(".active").attr("data-type"),f(e,function(){v(),m()})},k=function(e,t,a){p.post({url:e,datas:t,successCallback:function(){v(),a.removeClass("unread").addClass("read").find(".tips").text("[ 已读 ]")}})};n(".unread").find("._unread").click(function(){var e=n(this),t="undefined"==typeof e.parent().find("._infoId").val()?e.parent().parent():e.parent(),a=t.find("._infoId").val();r=n(".type-tab-btn").find(".active").attr("data-type"),"1"==r||"3"==r?k("/vip/user/"+g+"/message/read",a,t):"2"==r&&k("/vip/user/"+g+"/notification/read",a,t)}),n(".remarkYes").click(function(){r=n(".type-tab-btn").find(".active").attr("data-type"),"1"==r||"3"==r?y(_(r).read_message_url):"2"==r&&y(_(r).read_info_url),n("#tableList").find(":checkbox:checked").prop("checked",!1),n("#check-items .active").removeClass("unread active").addClass("read").find(".tips").text("[ 已读 ]")}),n(".delete").click(function(){r=n(".type-tab-btn").find(".active").attr("data-type"),"1"==r||"3"==r?y(_(r).delete_message_url):"2"==r&&y(_(r).delete_info_url),n("#check-items .active").remove()})};t(),a()&&n(window).on("popstate",function(){f=u.get("type")||1,m=u.get("current")||1,t()}),n(".type-tab-btn a").click(function(){n(this).addClass("active").siblings().removeClass("active"),v();var e=n(this).attr("data-type");a()&&history.pushState({title:document.title},document.title,location.href.split("?")[0]+"?type="+e),"1"==e||"3"==e?h(_(e).get_message_url,_(e).tpl,b):"2"==e&&h(_(e).get_info_url,_(e).tpl,b)})});