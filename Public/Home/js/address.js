define("member:app/script/page/address",function(e){e("member:app/script/module/handlebars-helper");var a,t,l,s=e("common:lib/jquery/jquery-1.11.3"),d=e("member:app/script/module/config-url"),i=e("member:app/script/handlebars"),n=e("member:app/script/module/cookie"),r=e("member:app/script/module/validate"),c=e("member:app/script/module/form-beautify"),o=e("member:app/script/module/rollingTo"),u=e("member:app/script/module/isToken"),m=e("member:app/script/module/isToken-jsonp"),p=1,v=e("member:app/script/module/dialog"),f=new v("alert"),h=JSON.parse(decodeURIComponent(n.getCookie("MEIZUSTORESESSIONVAL"))).uid,I=function(e,a,t,l,s){m.get({url:"http://area.meizu.com/area/child/query/"+s,codes:"success",vcode:!0,successCallback:function(e){var s='<option value="" style="display:none"></option>\n{{#each data}}\n<option value="{{code}}" data-zipCode="{{zipCode}}">{{name}}</option>\n{{/each}}';a.html("").html(i.compile(s)(e)),c.select.init(t,l)}})},b={city:function(e){var a=s("#mzuiSelect-cityId .mzui_select_item"),t=s(".cityId"),l=s(".mzui_select_city"),d=s("#mzuiSelect-cityId ul");I(a,t,l,d,e)},area:function(e){var a=s("#mzuiSelect-areaId .mzui_select_item"),t=s(".areaId"),l=s(".mzui_select_area");element=s("#mzuiSelect-areaId ul"),I(a,t,l,element,e)},town:function(e){var a=s("#mzuiSelect-townId .mzui_select_item"),t=s(".townId"),l=s(".mzui_select_town");element=s("#mzuiSelect-townId ul"),I(a,t,l,element,e)}};s("#mzuiSelect-provinceId .mzui_select_item").click(function(){var e=s(this).attr("data-value");b.city(e)}),s(document).on("click","#mzuiSelect-cityId .mzui_select_item",function(){var e=s(this).attr("data-value");b.area(e)}),s(document).on("click","#mzuiSelect-areaId .mzui_select_item",function(){var e=s(this).attr("data-value");b.town(e)}),s(document).on("click","#mzuiSelect-townId .mzui_select_item",function(){var e=s(this).attr("data-value");return 0==e?void s(".mzui_select_other").removeClass("hide"):void s(".mzui_select_other").addClass("hide")});var z=function(e){var d=s("#default")[0].checked===!0?1:0,i=""==s(".townId").val()?l:s(".townId").val(),n="其他"==s(".town").val()?s("._otherAddress").val():s(".town").val(),r=s(".area").val()==s(".town").val()?s(".area").val():s(".area").val()+n,c={address:s("#detailAddress").val(),completeAddress:s(".province").val()+s(".city").val()+r+s("#detailAddress").val(),areaId:""==s(".areaId").val()?t:s(".areaId").val(),cityId:""==s(".cityId").val()?a:s(".cityId").val(),id:1===p?"":e,isDefault:d,provinceId:s(".provinceId").val(),receiver:s("#name").val(),telNumber:s("#phone").val(),townId:i,userId:h,town:s("._otherAddress").val(),zipCode:s("#mzuiSelect-areaId").find(".mzui_select_item_selected").attr("data-zipcode")};return JSON.stringify(c)},_=function(){u.get({url:d+"/vip/address/"+h,successCallback:function(e){sHtml='{{#each data}}\n<li>\n    <input class="addressId" type="hidden" value="{{id}}">\n    <input class="isOld" type="hidden" value="{{isOld}}">\n\n    <span class="center w15">{{receiver}}</span>\n    <span class="completeAddress center w35">{{completeAddress}}</span>\n    <span class="center w25">{{telNumber}}</span>\n    <span class="center w10">\n      {{#equal isOld 1}}\n      <a class="edit" href="javascript:;">升级</a>\n      {{/equal}}\n      {{#equal isOld 0}}\n      <a class="edit" href="javascript:;">修改</a>\n      {{/equal}}\n      <a class="delete" href="javascript:;">删除</a>\n    </span>\n    <span class="left w15">\n      {{#equal isOld 1}}\n      <a class="edit uploadBtn" href="javascript:;">立即升级</a>\n      {{/equal}}\n      {{#equal isOld 0}}\n        {{#equal isDefault 1}}\n        <i class="iconfont icon-default"></i>\n        <i class="defaultAddress">默认地址</i>\n        {{/equal}}\n        {{#equal isDefault 0}}\n        <a class="beDefault hide" href="javascript:;">设为默认</a>\n        {{/equal}}\n      {{/equal}}\n    </span>\n</li>\n{{/each}}',s("#tableList").html(i.compile(sHtml)(e));var n=s("#tableList li"),r=n.length;n.hover(function(){s(this).addClass("active"),s(this).find(".beDefault").removeClass("hide")},function(){s(this).removeClass("active"),s(this).find(".beDefault").addClass("hide")});var c=s(".isOld");isOldArr=Array.prototype.slice.call(c),num=0;for(var m=0,f=isOldArr.length;f>m;m++)num+=isOldArr[m].value;num>0?s(".upload").removeClass("hide"):s(".upload").addClass("hide"),s(".already").text(r),s(".settle").text(0>=10-r?0:10-r),s(".delete").click(function(){var e=new v("confirm"),a=s(this).parent().parent().find(".addressId").val();e.run({titStr:"",contStr:"确定要删除地址？",confirmFunc:function(){u.post({url:d+"/vip/address/"+h+"/delete/"+a,successCallback:function(){_()}})}})}),s(".beDefault").click(function(){var e=s(this).parent().parent().find(".addressId").val();u.post({url:d+"/vip/address/default/"+h+"/"+e,successCallback:function(){_()}})}),s(".edit").click(function(){p=0,s("#valid-form")[0].reset(),s("#mzuiSelect-cityId ul,#mzuiSelect-areaId ul,#mzuiSelect-townId ul").html("");{var e=s(this);new o({oFinish:s(".rollit"),varsSpeed:300,fnAdditional:function(){var i=e.parent().parent().find(".addressId").val();s(".rollit").text("修改收货地址"),u.get({url:d+"/vip/address/"+h+"/"+i,successCallback:function(e){var d=e.data;s("#valid-form .addressId").val(d.id),s("#name").val(d.receiver),s("#phone").val(d.telNumber),s("#detailAddress").val(d.address),s("#default")[0].checked=1==d.isDefault?!0:!1,1!=d.isOld&&(b.city(d.provinceId),b.area(d.cityId),b.town(d.areaId),s(".province").val(d.province),s(".provinceId").val(d.provinceId),s(".city").val(d.city),s(".area").val(d.area),0==d.townId?(s(".mzui_select_other").removeClass("hide"),s(".town").val("其他"),s("._otherAddress").val(d.town)):s(".town").val(d.town),a=d.cityId,t=d.areaId,l=d.townId)}})}})}})}})};_(),s(".varify").on({focus:function(){s(this).addClass("active")},blur:function(){s(this).removeClass("active")}}),s("#name").on("keyup blur",function(){r.addressName(s("#name"))}),s("#phone").on("keyup blur",function(){r.addressPhone(s("#phone"))}),s(".provinceId").on("change",function(){s("#mzuiSelect-areaId ul,#mzuiSelect-townId ul").html(""),s(".city,.area,.town").val(""),r.addressSelect(s(".province"),"请选择所在省/直辖市")}),s(".cityId").on("change",function(){s("#mzuiSelect-townId ul").html(""),s(".area,.town").val(""),r.addressSelect(s(".city"),"请选择所在城市")}),s(".areaId").on("change",function(){s(".town").val(""),r.addressSelect(s(".area"),"请选择所在区/县")}),s(".townId").on("change",function(){r.addressSelect(s(".town"),"请选择所在乡镇/街道")}),s("#detailAddress").on("keyup blur",function(){r.addressDetail(s("#detailAddress"))}),s("._otherAddress").on("keyup blur",function(){r.addressName(s("._otherAddress"))}),s(".saveAddress").click(function(){var e=r.addressName(s("#name"))===!0?0:1,i=r.addressPhone(s("#phone"))===!0?0:1,n=r.addressSelect(s(".province"),"请选择所在省/直辖市")===!0?0:1,c=r.addressSelect(s(".city"),"请选择所在城市")===!0?0:1,o=r.addressSelect(s(".area"),"请选择所在区/县")===!0?0:1,m=r.addressSelect(s(".town"),"请选择所在乡镇/街道")===!0?0:1,v=(r.addressName(s("._otherAddress"))===!0&&s(".mzui_select_other").hasClass("hide")===!1||s(".mzui_select_other").hasClass("hide")===!0)==!0?0:1,h=r.addressDetail(s("#detailAddress"))===!0?0:1,I=e+i+n+c+o+m+v+h;if(0===I){var b=parseInt(s(".already").text()),y=10,w=1===p?d+"/vip/address/add":d+"/vip/address/update";if(b>=y&&1==p)return void f.run("您添加的地址数量已超过上限，请管理您的地址！");u.post({url:w,datas:z(s("#valid-form .addressId").val()),beforeSend:function(){s(".saveAddress").prop("disabled",!0).addClass("disabled")},successCallback:function(){s(".saveAddress").prop("disabled",!1).removeClass("disabled"),s(".rollit").text("新增收货地址"),_(),s("#valid-form")[0].reset(),s(".mzui_select_other").addClass("hide"),p=1,a=null,t=null,l=null,s("#mzuiSelect-cityId ul").html(""),s("#mzuiSelect-areaId ul").html(""),s("#mzuiSelect-townId ul").html("")},completeCallback:function(){s(".saveAddress").prop("disabled",!1).removeClass("disabled")}})}})});